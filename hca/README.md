# Hosting Capacity Analysis
## Basic usage
### Step 1: Initialize Object
initialize the hosting capacity object with a configuration file:
```python
import hca as h

inputs = h.load_config("defaults.json")
hca = h.HCA(inputs)
```
### Step 2: Run Baseline Case
The base line case can establish some pre-determined changes to the feeder.
Additionally, the baseline is used when evaluating the hosting capacity metrics.
In the event that the baseline _violates_ any of the limits specified in the input configuration, the limit is changed to being "no worse than the baseline".

```python
hca.runbase()
```

### Step 3: Perform hosting capacity steps
Method `hca_round` performs one "round" of hosting capacity.
In a round:
* A resource type is specified (only `"pv"`` tested presently)
* A location, $n$, is sampled (or specified)
* A capacity, $S_0$, is sampled (or specified)

The following outcomes are possible:
1. No violations with initial capacity $S_0$:
    * A bisection search is performed to find the largest capacity, $S_{lim}$, that doesn't result in violations.
    * A unit with capacity $S_0$ is added at $n$.
    * The hosting capacity is recorded as $S_{lim} - S_0$.
2. Violations occur with initial capacity $S_0$:
    * A bisection search is performed to find the largest capacity, $S_{lim}$, that doesn't result in violations.
    * A unit with capacity $S_{lim}$ is added at $n$.
    * The hosting capacity is recorded as 0.

An HCA round (for a pv unit) is performed via the command:
```python
hca.hca_round("pv")
```
It's also possible to specify either location and/or capacity, for example:
```python
hca.hca_round("pv", bus="n1144663", 
    Sij={"kw":193.5, "kva":241.875})
```
will perform an HCA round at bus `"n1144663"` starting with a capacity of 241.875 kVA.


## Testing/Example
An example/test is available in the `tests` folder, which performs 3 rounds of HCA on the IEEE 9500 Node feeder, and can be run (in the `tests` folder) via:
```
>python ieee9500node_test.py
```

The result should look like this:
![](tests/hca9500node_test.png)

_Note_: There are only 2 PV units showing.
That is because the second PV unit selected is very close to the first one, and no hosting capacity was left at that location.

## Issue with $\Delta V$ Errors
There appear to be additions that result in regulator actions or some other control that lead to a sudden large drop in the voltage.

Running:
```
>python ieee9500node_vdiff_test.py
```
Illustrates this issue.

It add a 450 kW PV at bus n1134480.
```python
### add solar to bus n1134480
bus = "n1134480"
Sij = {"kw": 450}
Sij["kva"] = Sij["kw"]/0.8
# run hca round allowing violations (violation should occur)
hca.hca_round("pv", bus=bus, Sij=Sij, allow_violations=True)
```
This generates a voltage difference violation.

The code then upgrades the full path between this node and the source bus, essentially by simulating a doubling of the circuit.
For lines the length is halved and the rating doubled.
For transformers the kVA rating is doubled.

The results however, irrespective of inverter control action are minimal and insignificant (the end of the log generated by the test should look something like this):
```
**** Impact of Inverer Mode and Upgrade ****
Results with inverter mode CONSTANT_PF
pre: -9.428115561680414, post: -9.346122136888917
Results with inverter mode VOLT_WATT
pre: -9.428115561680414, post: -9.346122136888917
Results with inverter mode VOLT_VAR_CATA
pre: -9.428115561680414, post: -9.346122136888917
Results with inverter mode VOLT_VAR_CATB
pre: -9.428115561680414, post: -9.346122136888917
Results with inverter mode VOLT_VAR_AVR
pre: -9.428115561680414, post: -9.346122136888917
Results with inverter mode VOLT_VAR_VOLT_WATT
pre: -9.428115561680414, post: -9.346122136888917
Results with inverter mode VOLT_VAR_14H
pre: -9.428115561680414, post: -9.346122136888917
```

1. The inverter functions make no impact on the $\Delta V$ violation
2. The impact of upgrading the *full* circuit is meaningless compared to the degree of violation.

This seems to suggest that at least with the current tools available in this analysis, a $\Delta V$ violation is basically a "knock-out" criterion.